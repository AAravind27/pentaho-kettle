buildProperties:
  BUILD_PLAN_ID                    : Suite Snapshot Build

  USE_MINION_JOBS                  : true
  IGNORE_PIPELINE_FAILURE          : true
  RELEASE_BUILD_NUMBER             : latest

  ARCHIVING_CONFIG                 : ${BUILD_CONFIG_ROOT_PATH}/artifacts/snapshot-manifest.yaml
  ARCHIVING_PATH_GROUP_REGEX       : '.*/target/(?:(windows|linux|mac|classes/ia/pentaho-update)(?!.*(dependencies)).*/)?'

  MAVEN_DEFAULT_COMMAND_OPTIONS    : -B -e
  # we are running in containers, let the maven process have most of the memory available
  MAVEN_OPTS                       : -Xmx4g -XX:MaxRAMPercentage=90.0

  ARTIFACT_DEPLOYER_CREDENTIALS_ID : jfrog-pentaho-service-cicd
  ARTIFACTORY_BASE_URL             : https://one.hitachivantara.com
  ARTIFACTORY_BASE_API_URL         : ${ARTIFACTORY_BASE_URL}/artifactory

  MAVEN_RESOLVE_REPO_URL           : https://one.hitachivantara.com/artifactory/pnt-mvn/
  MAVEN_PUBLIC_SNAPSHOT_REPO_URL   : https://one.hitachivantara.com/artifactory/pntpub-maven-snapshot/
  MAVEN_PRIVATE_SNAPSHOT_REPO_URL  : https://one.hitachivantara.com/artifactory/pntprv-maven-snapshot/

  DOCKER_REGISTRY_URL              : https://one.hitachivantara.com
  DOCKER_IMAGE_HOST                : one.hitachivantara.com/pnt-docker
  DOCKER_PUBLIC_PUSH_REPO          : one.hitachivantara.com/pntpub-docker-dev
  DOCKER_PRIVATE_PUSH_REPO         : one.hitachivantara.com/pntprv-docker-dev

  NODEJS_BUNDLE_REPO_URL           : https://one.hitachivantara.com/artifactory/nodejs-generic-remote/
  NPM_RELEASE_REPO_URL             : https://one.hitachivantara.com/artifactory/npm-release/npm/-/


  # Jenkins can timeout if a groovy method takes longer than 5 minutes (see
  # https://issues.jenkins-ci.org/browse/JENKINS-46507). For highly
  # parallel tasks like checkout, test, tagging, and archiving, reduce
  # to a reasonable size to reduce the risk of timeout failures.
  PARALLEL_SIZE_CHECKOUT           : 15
  PARALLEL_SIZE_TEST               : 20
  PARALLEL_SIZE_TAG                : 20
  PARALLEL_SIZE_ARCHIVE            : 10

  MAVEN_DEFAULT_DIRECTIVES:
    build        : clean deploy -DskipTests
    test         : test -Djs.no.sandbox

  JOB_ITEM_DEFAULTS:
    dockerImage  : jenkins-build/maven/open-jdk/17
    scmBranch    : master

jobGroups:
  200:
     - jobID           :  coding-standards
       scmUrl          :  https://github.com/pentaho/pentaho-coding-standards.git
       testable        :  false

  300:
     - jobID           :  parent-poms
       scmUrl          :  https://github.com/pentaho/maven-parent-poms.git

  400:
     - jobID           :  parent-poms-ee
       scmUrl          :  https://github.com/pentaho/maven-parent-poms-ee.git
       directives      :  += -Dobfuscate-version-for-license-phase=none

  500:
     - jobID           :  archetypes
       scmUrl          :  https://github.com/pentaho/maven-project-archetypes.git

     - jobID           :  metastore
       scmUrl          :  https://github.com/pentaho/metastore.git

     - jobID           :  reporting-pom
       scmUrl          :  https://github.com/pentaho/pentaho-reporting.git
       directives      :  += -pl .

  600:
     - jobID           :  osgi-bundles-lowdeps
       scmUrl          :  https://github.com/pentaho/pentaho-osgi-bundles.git
       directives      :  += -P lowdeps -DskipDefault

     - jobID           :  oss-license-assembly
       scmUrl          :  https://github.com/pentaho/oss-licenses.git
       testable        :  false

     - jobID           :  database-model
       scmUrl          :  https://github.com/pentaho/pentaho-commons-database.git
       directives      :  += -pl .,model

     - jobID           :  mongo-utils
       scmUrl          :  https://github.com/pentaho/pentaho-mongo-utils.git

     - jobID           :  eula-wrap-config
       scmUrl          :  https://github.com/pentaho/pentaho-eula-wrap-config.git

     - jobID           :  reporting-libraries-lowdeps
       scmUrl          :  https://github.com/pentaho/pentaho-reporting.git
       directives      :  += -Plowdeps
       root            :  libraries

     - jobID           :  encryption-support
       scmUrl          :  https://github.com/pentaho/pentaho-encryption-support.git

  700:
     - jobID           :  reporting-engine-core
       scmUrl          :  https://github.com/pentaho/pentaho-reporting.git
       directives      :  += -Pcore
       root            :  engine

     - jobID           :  gwt-widgets
       scmUrl          :  https://github.com/pentaho/pentaho-commons-gwt-modules.git

     - jobID           :  connections
       scmUrl          :  https://github.com/pentaho/pentaho-connections.git

     - jobID           :  commons-json
       scmUrl          :  https://github.com/pentaho/pentaho-commons-json.git

     - jobID           :  application-launcher
       scmUrl          :  https://github.com/pentaho/pentaho-application-launcher.git

     - jobID           :  version-checker
       scmUrl          :  https://github.com/pentaho/pentaho-versionchecker.git

     - jobID           :  hdfs-vfs
       scmUrl          :  https://github.com/pentaho/pentaho-hdfs-vfs.git

     - jobID           :  apache-vfs-browser
       scmUrl          :  https://github.com/pentaho/apache-vfs-browser.git

  800:
     - jobID           :  xul
       scmUrl          :  https://github.com/pentaho/pentaho-commons-xul.git

     - jobID           :  actionsequence-dom
       scmUrl          :  https://github.com/pentaho/pentaho-actionsequence-dom.git

  900:
     - jobID           :  metadata-registry
       scmUrl          :  https://github.com/pentaho/pentaho-registry.git

  1000:
     - jobID           :  mondrian-jar
       scmUrl          :  https://github.com/pentaho/mondrian.git
       directives      :  += -P !workbench -P !assemblies

     - jobID           :  platform-api
       scmUrl          :  https://github.com/pentaho/pentaho-platform.git
       directives      :  += -DskipDefault -P platform-api

  1100:
     - jobID           :  pdi-engine-core
       scmUrl          :  https://github.com/pentaho/pentaho-kettle.git
       directives      :  += -DskipDefault -P base,plugins,lowdeps

  1200:
     - jobID           :  metadata
       scmUrl          :  https://github.com/pentaho/pentaho-metadata.git

     - jobID           :  license-ee-api
       scmUrl          :  https://github.com/pentaho/pentaho-ee-license.git
       directives      :  += -Dmaven.test.failure.ignore=true -pl .,pentaho-license-validator-api,pentaho-license-validator

  1250:
     - jobID           :  revenera-validator
       scmUrl          :  https://github.com/pentaho/pentaho-license-validator-revenera.git
       directives      :  += -Plinux_64

  1300:
     - jobID           :  database-gwt
       scmUrl          :  https://github.com/pentaho/pentaho-commons-database.git
       directives      :  += -pl gwt

     - jobID           :  vertica-bulkloader
       scmUrl          :  https://github.com/pentaho/pentaho-vertica-bulkloader.git

     - jobID           :  pdi-teradata-tpt-plugin
       scmUrl          :  https://github.com/pentaho/pdi-teradata-tpt-plugin.git

     - jobID           :  chartbeans
       scmUrl          :  https://github.com/pentaho/pentaho-chartbeans.git

     - jobID           :  license-ee-core
       scmUrl          :  https://github.com/pentaho/pentaho-ee-license.git
       directives      :  += -Dmaven.test.failure.ignore=true -pl core,ftp-installer,mock,assemblies,metadata-client-tool -amd

     - jobID           :  pdi-dataservice-plugin
       scmUrl          :  https://github.com/pentaho/pdi-dataservice-plugin.git

     - jobID           :  big-data-hadoop-shims-api
       scmUrl          :  https://github.com/pentaho/pentaho-hadoop-shims.git
       directives      :  += -DskipDefault -P shim-api

  1400:
     - jobID           :  archetypes-ee
       scmUrl          :  https://github.com/pentaho/maven-project-archetypes-ee.git

     - jobID           :  big-data-plugin-lowdeps
       scmUrl          :  https://github.com/pentaho/big-data-plugin.git
       directives      :  += -DskipDefault -P lowdeps

  1410:
     - jobID           :  big-data-hadoop-shims-common
       scmUrl          :  https://github.com/pentaho/pentaho-hadoop-shims.git
       directives      :  += -DskipDefault -P common

  1420:
     - jobID           :  big-data-hadoop-shims
       scmUrl          :  https://github.com/pentaho/pentaho-hadoop-shims.git
       directives      :  += -DskipDefault -P all
       archivable      :  true
       root            :  shims

  1500:
     - jobID           :  big-data-splunk-plugin
       scmUrl          :  https://github.com/pentaho/pentaho-splunk-plugin.git

  1600:
     - jobID           :  mondrian-workbench
       scmUrl          :  https://github.com/pentaho/mondrian.git
       directives      :  += -P workbench

  1700:
     - jobID           :  mondrian-schema-workbench-plugins
       scmUrl          :  https://github.com/pentaho/pentaho-mondrianschemaworkbench-plugins.git

  1800:
     - jobID           :  psw-assembly
       scmUrl          :  https://github.com/pentaho/mondrian.git
       directives      :  += -P assemblies
       testable        :  false
       archivable      :  true

  1900:
     - jobID           :  psw-assembly-ee
       scmUrl          :  https://github.com/pentaho/pentaho-schema-workbench-ee.git
       testable        :  false
       archivable      :  true

     - jobID           :  reporting-engine-extensions
       scmUrl          :  https://github.com/pentaho/pentaho-reporting.git
       directives      :  += -Pextensions
       root            :  engine

  2000:
     - jobID           :  reportwizard-core
       scmUrl          :  https://github.com/pentaho/pentaho-reportwizard-core.git

  2100:
     - jobID           :  platform-base
       scmUrl          :  https://github.com/pentaho/pentaho-platform.git
       directives      :  += -DskipDefault -P platform-base
       parallelize     :  true
       archivable      :  true

  2200:
     - jobID           :  osgi-bundles-highdeps
       scmUrl          :  https://github.com/pentaho/pentaho-osgi-bundles.git
       directives      :  += -P highdeps -DskipDefault

     - jobID           :  mql-editor
       scmUrl          :  https://github.com/pentaho/mql-editor.git

     - jobID           :  pdi-palo-plugin
       scmUrl          :  https://github.com/pentaho/pdi-palo-core.git

  2300:
     - jobID           :  pdi-osgi-bridge
       scmUrl          :  https://github.com/pentaho/pdi-osgi-bridge.git
       directives      :  += -P modules

     - jobID           :  metaverse-plugin
       scmUrl          :  https://github.com/pentaho/pentaho-metaverse.git

#     - jobID           :  layout-editor
#       scmUrl          :  https://github.com/pentaho/layout-editor.git

  2350:
      - jobID           : pentaho-scheduler-plugin
        scmUrl          : https://github.com/pentaho/pentaho-scheduler-plugin.git
  2400:
     - jobID           :  big-data-mongodb-plugin
       scmUrl          :  https://github.com/pentaho/pentaho-mongodb-plugin.git

     - jobID           :  pdi-core-plugins
       scmUrl          :  https://github.com/pentaho/pentaho-kettle.git
       directives      :  += -DskipDefault -P highdeps
       root            :  plugins
       parallelize     :  true

     - jobID           :  modeler
       scmUrl          :  https://github.com/pentaho/modeler.git

     - jobID           :  cpf-plugin
       scmUrl          :  https://github.com/webdetails/cpf.git

     - jobID           :  ccc-plugin
       scmUrl          :  https://github.com/webdetails/ccc.git

     - jobID           :  commons-ee
       scmUrl          :  https://github.com/pentaho/commons-ee.git

  2450:
    - jobID           :  pdi-monitoring-plugin
      scmUrl          :  https://github.com/pentaho/pdi-monitoring-plugin.git
      archivable      :  true

  2500:
     - jobID           :  camel-components
       scmUrl          :  https://github.com/pentaho/pentaho-camel-components.git

     - jobID           :  pdi-dataservice-server-plugin
       scmUrl          :  https://github.com/pentaho/pdi-dataservice-server-plugin.git

     - jobID           :  reporting-libraries-highdeps
       scmUrl          :  https://github.com/pentaho/pentaho-reporting.git
       directives      :  += -Phighdeps
       root            :  libraries

     - jobID           :  pdi-platform-plugin
       scmUrl          :  https://github.com/pentaho/pdi-platform-plugin.git
       testable        :  false

     - jobID           :  pdi-platform-utils-plugin
       scmUrl          :  https://github.com/pentaho/pdi-platform-utils-plugin.git

     - jobID           :  platform-plugin-jpivot
       scmUrl          :  https://github.com/pentaho/pentaho-platform-plugin-jpivot.git

     - jobID           :  cdf-plugin
       scmUrl          :  https://github.com/webdetails/cdf.git

  2600:
     - jobID           :  common-ui
       scmUrl          :  https://github.com/pentaho/pentaho-platform-plugin-common-ui.git

  2700:
     - jobID           :  data-access-plugin
       scmUrl          :  https://github.com/pentaho/data-access.git

     - jobID           :  marketplace-plugin
       scmUrl          :  https://github.com/pentaho/marketplace.git

     - jobID           :  platform-user-console
       scmUrl          :  https://github.com/pentaho/pentaho-platform.git
       directives      :  += -DskipDefault -P platform-user-console
       #parallelize     :  true

     - jobID           :  big-data-plugin-highdeps
       scmUrl          :  https://github.com/pentaho/big-data-plugin.git
       directives      :  += -DskipDefault -P highdeps

     - jobID           :  pdi-data-refinery-plugin
       scmUrl          :  https://github.com/pentaho/pentaho-data-refinery.git

  2800:
     - jobID           :  pdi-plugins-ee
       scmUrl          :  https://github.com/pentaho/pdi-plugins-ee.git
       archivable      :  true
       #parallelize     :  true

     - jobID           :  cde-plugin
       scmUrl          :  https://github.com/webdetails/cde.git

     - jobID           :  cpk-plugin
       scmUrl          :  https://github.com/webdetails/cpk.git

     - jobID           :  cgg-plugin
       scmUrl          :  https://github.com/webdetails/cgg.git

  2900:
     - jobID           :  sparkl-plugin
       scmUrl          :  https://github.com/webdetails/sparkl.git

     - jobID           :  platform-reporting-plugin
       scmUrl          :  https://github.com/pentaho/pentaho-platform-plugin-reporting.git
       #parallelize     :  true

  3000:
     - jobID           :  big-data-hadoop-shims-ee
       scmUrl          :  https://github.com/pentaho/pentaho-big-data-ee.git
       directives      :  += -DskipDefault -P base,all
       archivable      :  true
       atomicScmCheckout: true

     - jobID           :  cda-plugin
       scmUrl          :  https://github.com/webdetails/cda.git

  3100:
     - jobID           :  jdbc-distribution-utility
       scmUrl          :  https://github.com/pentaho/jdbc-distribution-utility.git

     - jobID           :  dashboards-chart-editor-plugin
       scmUrl          :  https://github.com/pentaho/pentaho-dashboard-chart-editor.git

  3200:
     - jobID           :  platform-ee
       scmUrl          :  https://github.com/pentaho/pentaho-platform-ee.git
       directives      :  += -DskipDefault -P platform-ee

  3300:
     - jobID           :  geo-plugin
       scmUrl          :  https://github.com/pentaho/pentaho-platform-plugin-geo.git
       archivable      :  true

  3400:
     - jobID           :  analyzer-plugin
       scmUrl          :  https://github.com/pentaho/pentaho-analyzer.git
       dockerImage     :  jenkins-build/headless-chrome
       directives      :  += -Dagilebi
       archivable      :  true

     - jobID           :  container-utils-internal
       scmUrl          :  https://github.com/pentaho/container-utils.git
       archivable      :  true

  3500:
     - jobID           :  platform-chart-plugin-ee
       scmUrl          :  https://github.com/pentaho/pentaho-ee-chart-plugin.git

     - jobID           :  analysis-plugin-ee
       scmUrl          :  https://github.com/pentaho/pentaho-analysis-ee.git
       archivable      :  true

     - jobID           :  pdi-yarn-plugin
       scmUrl          :  https://github.com/pentaho/pentaho-yarn-kettle-plugin.git

     - jobID           :  data-exploration
       scmUrl          :  https://github.com/pentaho/pentaho-det.git

     - jobID           :  big-data-plugin-features
       scmUrl          :  https://github.com/pentaho/big-data-plugin.git
       directives      :  += -DskipDefault -DfeaturesOnly
       root            :  assemblies

     - jobID           :  container-utils-public
       scmUrl          :  https://github.com/pentaho/container-utils.git
       root            :  dock-maker
       directives      :
                 build :  deploy -DskipTests -Drelease -Ppublic
                 test  :  test
       archivable      :  true
       versionProperty :  container-utils.version

     - jobID           :  pentaho-scheduler-plugin-ee
       scmUrl          :  https://github.com/pentaho/pentaho-scheduler-plugin-ee.git
       versionProperty :  pentaho-scheduler-plugin-ee.version

  3600:
     - jobID           :  data-exploration-ee
       scmUrl          :  https://github.com/pentaho/pentaho-det-ee.git

     - jobID           :  karaf-assembly
       scmUrl          :  https://github.com/pentaho/pentaho-karaf-assembly.git
       testable        :  false

     - jobID           :  dashboards-plugin
       scmUrl          :  https://github.com/pentaho/pentaho-platform-plugin-dashboards.git
       archivable      :  true

     - jobID           :  pdi-weka-plugins
       scmUrl          :  https://github.com/pentaho/pentaho-data-mining.git

  3700:
     - jobID           :  pdi-weka-plugins-ee
       scmUrl          :  https://github.com/pentaho/pentaho-data-mining-ee.git

     - jobID           :  pir-plugin
       scmUrl          :  https://github.com/pentaho/pentaho-platform-plugin-interactive-reporting.git
       archivable      :  true
       parallelize     :  true

     - jobID           :  pdi-scheduler-plugin
       scmUrl          :  https://github.com/pentaho/pdi-scheduler-plugin.git

     - jobID           :  pdi-jms-plugin
       scmUrl          :  https://github.com/pentaho/pdi-jms-plugin.git

     - jobID           :  pdi-sdk-plugins
       scmUrl          :  https://github.com/pentaho/pdi-sdk-plugins.git
       archivable      :  true

     - jobID           :  pdi-r-plugin
       scmUrl          :  https://github.com/pentaho/pentaho-r-plugin.git

     - jobID           :  pdi-sap-hana-bulk-loader-plugin
       scmUrl          :  https://github.com/pentaho/pdi-sap-hana-bulk-loader-plugin.git
       archivable      :  true

     - jobID           :  big-data-plugin-assembly
       scmUrl          :  https://github.com/pentaho/big-data-plugin.git
       directives      :  += -DskipDefault -DassemblyOnly
       archivable      :  true
       root            :  assemblies

  3800:
     - jobID           :  karaf-assembly-ee
       scmUrl          :  https://github.com/pentaho/pentaho-karaf-ee-assembly.git
       testable        :  false

  3900:
     - jobID           :  big-data-plugin-assembly-ee
       scmUrl          :  https://github.com/pentaho/pentaho-big-data-ee.git
       directives      :  += -DskipDefault -P assemblies
       testable        :  false
       archivable      :  true
       atomicScmCheckout: true

     - jobID           :  prd-assembly
       scmUrl          :  https://github.com/pentaho/pentaho-reporting.git
       directives      :  += -Pdesigner -Dmaven.test.failure.ignore=true
       testable        :  false
       archivable      :  true

  4000:
     - jobID           :  prd-assembly-ee
       scmUrl          :  https://github.com/pentaho/pentaho-reportdesigner-ee.git
       testable        :  false
       archivable      :  true

     - jobID           :  pdi-pur-plugin-ee
       scmUrl          :  https://github.com/pentaho/pdi-ee-plugin.git
       archivable      :  true

     - jobID           :  prd-assembly-osgi
       scmUrl          :  https://github.com/pentaho/pentaho-reporting.git
       directives      :  += -Dosgi -Pdesigner -Dmaven.test.failure.ignore=true
       root            :  assemblies/prd-ce
       archivable      :  true

  4100:
     - jobID           :  pdi-operations-mart-ee
       scmUrl          :  https://github.com/pentaho/pdi-operations-mart.git
       archivable      :  true

     - jobID           :  prd-assembly-ee-osgi
       scmUrl          :  https://github.com/pentaho/pentaho-reportdesigner-ee.git
       root            :  assemblies/prd-ee
       directives      :  += -Dosgi
       archivable      :  true
       testable        :  false

  4200:
     - jobID           :  pdi-client-assembly
       scmUrl          :  https://github.com/pentaho/pentaho-kettle.git
       directives      :  += -DskipDefault -P assemblies
       testable        :  false
       archivable      :  true

  4300:
     - jobID           :  pdi-client-assembly-ee
       scmUrl          :  https://github.com/pentaho/pdi-assemblies-ee.git
       testable        :  false
       archivable      :  true

     - jobID           :  pdi-client-assembly-osgi
       scmUrl          :  https://github.com/pentaho/pentaho-kettle.git
       directives      :  += -Dosgi -DskipDefault -P assemblies
       testable        :  false
       archivable      :  true

     - jobID           :  metadata-editor
       scmUrl          :  https://github.com/pentaho/pentaho-metadata-editor.git
       testable        :  false
       archivable      :  true
       versionProperty :  pentaho-metadata.version

  4400:
     - jobID           :  metadata-editor-osgi
       scmUrl          :  https://github.com/pentaho/pentaho-metadata-editor.git
       directives      :  += -Dosgi
       archivable      :  true
       versionProperty :  pentaho-metadata.version

     - jobID           :  platform-server-assembly
       scmUrl          :  https://github.com/pentaho/pentaho-platform.git
       directives      :  += -DskipDefault -P platform-assemble
       testable        :  false
       archivable      :  true

     - jobID           :  pad
       scmUrl          :  https://github.com/pentaho/pentaho-aggdesigner.git
       # Disabled testing on this project due to foodmart db offline and connection problems
       testable         : false
       archivable      :  true

     - jobID           :  pdi-client-assembly-ee-osgi
       scmUrl          :  https://github.com/pentaho/pdi-assemblies-ee.git
       directives      :  += -Dosgi
       testable        :  false
       archivable      :  true

  4500:
     - jobID           :  platform-server-assembly-ee
       scmUrl          :  https://github.com/pentaho/pentaho-platform-ee.git
       directives      :  += -DskipDefault -P platform-ee-assemble
       testable        :  false
       archivable      :  true

     - jobID           :  metadata-editor-ee
       scmUrl          :  https://github.com/pentaho/pentaho-metadata-editor-ee.git
       testable        :  false
       archivable      :  true

     - jobID           :  pad-assembly-ee
       scmUrl          :  https://github.com/pentaho/pentaho-aggdesigner-ee.git
       testable        :  false
       archivable      :  true

     - jobID           :  platform-sdk
       scmUrl          :  https://github.com/pentaho/pentaho-sdk.git
       archivable      :  true

     - jobID           :  metadata-editor-osgi
       scmUrl          :  https://github.com/pentaho/pentaho-metadata-editor.git
       directives      :  += -Dosgi
       archivable      :  true

  4600:
     - jobID           :  metadata-editor-ee-osgi
       scmUrl          :  https://github.com/pentaho/pentaho-metadata-editor-ee.git
       directives      :  += -Dosgi
       archivable      :  true

  5000:
    - jobID: generate-download-page
      scmUrl: https://github.com/pentaho/jenkins-pipelines.git
      dockerImage: groovy:jdk11
      buildFramework: DSL_SCRIPT
      script: |
        { ->
          catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') {
            withCredentials([usernamePassword(credentialsId: '${ARTIFACT_DEPLOYER_CREDENTIALS_ID}',
              usernameVariable: 'JF_USER', passwordVariable: 'JF_TOKEN')]) {
              def scriptToRun = """\
                ${WORKSPACE}/scripts/hosted/hosted.groovy \
                  --rtURL '${ARTIFACTORY_BASE_API_URL}' \
                  --rtUsername '${JF_USER}' \
                  --rtPassword '${JF_TOKEN}' \
                  --buildHostingRoot ${BUILD_HOSTING_ROOT} \
                  --deploymentFolder ${DEPLOYMENT_FOLDER} \
                  --manifest-file ${ARCHIVING_CONFIG} \
                  --versions-file ${BUILD_CONFIG_ROOT_PATH}/version.properties \
                  --releaseBuildNumber ${RELEASE_BUILD_NUMBER} \
                  --releaseVersion ${RELEASE_VERSION} \
                  --isSnapshot true
                  """
              sh(script: scriptToRun)
            }
          }
        }
      testable: false

    - jobID: rebuild-download-page-json
      scmUrl: https://github.com/pentaho/devops-download-proxy-server.git
      dockerImage: groovy:jdk11
      buildFramework: DSL_SCRIPT
      script: |
        { ->
          catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') {
            withCredentials([string(credentialsId: '${SCM_API_TOKEN_CREDENTIALS_ID}', variable: 'GITHUB_TOKEN')]) {
              env.BRANCH_NAME = "${GIT_BRANCH.split("/")[1]}"
              def script2Run = """\
                # dispatch the github workflow
                curl -L \
                  -X POST \
                  -H 'Accept: application/vnd.github+json' \
                  -H 'Authorization: Bearer ${GITHUB_TOKEN}'\
                  -H 'X-GitHub-Api-Version: 2022-11-28' \
                  https://api.github.com/repos/pentaho/devops-download-proxy-server/actions/workflows/update-file-mapping-json.yml/dispatches \
                  -d '{ "ref":"main", \
                        "inputs":{ \
                          "deployment-folder":"${DEPLOYMENT_FOLDER} ", \
                          "is-snapshot":"true", \
                          "release-version":"${RELEASE_VERSION}", \
                          "jenkins-pipelines-branch:"${env.BRANCH_NAME}" \
                        } \
                      }'
              """
              def response = sh(script: script2Run, returnStdout: true).trim()
              echo response
            }
          }
        }
      testable: false
