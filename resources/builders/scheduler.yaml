################################################################################
# NOTE temporary file, only used for partial builds for the feature branch     #
# This file's groupIds and jobIds will match suite-snapshot.yaml               #
# THIS FILE SHOULD NOT GET MERGED INTO main branches: 'master', '9.6.0.0', ... #
################################################################################

buildProperties:
  BUILD_PLAN_ID: Suite Snapshot Build

  USE_MINION_JOBS: true
  IGNORE_PIPELINE_FAILURE: true
  RELEASE_BUILD_NUMBER: latest

  ARCHIVING_CONFIG: ${BUILD_CONFIG_ROOT_PATH}/artifacts/snapshot-manifest.yaml
  ARCHIVING_PATH_GROUP_REGEX: '.*/target/(?:(windows|linux|mac|classes/ia/pentaho-update)(?!.*(dependencies)).*/)?'

  MAVEN_DEFAULT_COMMAND_OPTIONS: -B -e
  # we are running in containers, let the maven process have most of the memory available
  MAVEN_OPTS: -Xmx4g -XX:MaxRAMPercentage=90.0

  MAVEN_PUBLIC_SNAPSHOT_REPO_URL : https://repo.orl.eng.hitachivantara.com/artifactory/pntprv-mvn-scheduler-snapshot-orl/
  MAVEN_PRIVATE_SNAPSHOT_REPO_URL: https://repo.orl.eng.hitachivantara.com/artifactory/pntprv-mvn-scheduler-snapshot-orl/
  MAVEN_RESOLVE_REPO_URL         : https://repo.orl.eng.hitachivantara.com/artifactory/pntprv-scheduler/

  DOCKER_PUBLIC_PUSH_REPO        : pntpub-docker-scheduler-dev-orl.repo.orl.eng.hitachivantara.com/
  DOCKER_PRIVATE_PUSH_REPO       : pntprv-docker-scheduler-dev-orl.repo.orl.eng.hitachivantara.com/

  HELM_REPOSITORY_URL            : https://repo.orl.eng.hitachivantara.com/artifactory/lumadadataintegration-helm-dev-orl

  # Jenkins can timeout if a groovy method takes longer than 5 minutes (see
  # https://issues.jenkins-ci.org/browse/JENKINS-46507). For highly
  # parallel tasks like checkout, test, tagging, and archiving, reduce
  # to a reasonable size to reduce the risk of timeout failures.
  PARALLEL_SIZE_CHECKOUT: 15
  PARALLEL_SIZE_TEST    : 20
  PARALLEL_SIZE_TAG     : 20
  PARALLEL_SIZE_ARCHIVE : 10

  MAVEN_DEFAULT_DIRECTIVES:
    build: -U clean deploy -DskipTests
    test: test

  JOB_ITEM_DEFAULTS:
    dockerImage       :  jenkins-build/maven/open-jdk/11
    scmBranch         :  master

jobGroups:
  ################################################################################
  # Build the 'pentaho-commons-gwt-modules first because the platform and the    #
  # scheduler-plugin depend on gwt changes.                                      #
  ################################################################################
  700:
    - jobID           :  pentaho-commons-gwt-modules
      scmUrl          :  https://github.com/pentaho/pentaho-commons-gwt-modules.git
      scmBranch       :  scheduler-plugin

  ################################################################################
  # For now build the entire pentaho-platform.  There are changes in extnsions   #
  # and scheduler modules that will be needed                                    #
  ################################################################################
  1000:
    - jobID           : platform-api
      scmUrl          : https://github.com/pentaho/pentaho-platform.git
      scmBranch       : scheduler-plugin
      directives      : += -DskipDefault -P platform-api

  2100:
    - jobID           : platform-base
      scmUrl          : https://github.com/pentaho/pentaho-platform.git
      scmBranch       : scheduler-plugin
      directives      : += -DskipDefault -P platform-base
      parallelize     : true
      archivable      : true

  2500:
     - jobID           :  pdi-platform-plugin
       scmUrl          :  https://github.com/pentaho/pdi-platform-plugin.git
       scmBranch       :  scheduler-plugin
       testable        :  false
  2600:
    - jobID           : common-ui
      scmUrl          : https://github.com/pentaho/pentaho-platform-plugin-common-ui.git
      scmBranch       : scheduler-plugin
      versionProperty : pentaho-scheduler-plugin-ee.version

  2700:
    - jobID           : platform-user-console
      scmUrl          : https://github.com/pentaho/pentaho-platform.git
      scmBranch       : scheduler-plugin
      directives      : += -DskipDefault -P platform-user-console
      #parallelize     :  true
      
  2800:
    - jobID           :  pdi-plugins-ee
      scmUrl          :  https://github.com/pentaho/pdi-plugins-ee.git
      scmBranch       :  scheduler-plugin
      #parallelize     :  true
      
  2900:
    - jobID           : platform-reporting-plugin
      scmUrl          : https://github.com/pentaho/pentaho-platform-plugin-reporting.git
      #parallelize     :  true

  3000:
     - jobID           :  cda-plugin
       scmUrl          :  https://github.com/webdetails/cda.git
       scmBranch       :  scheduler-plugin
  3200:
    - jobID           : platform-ee
      scmUrl          : https://github.com/pentaho/pentaho-platform-ee.git
      scmBranch       : scheduler-plugin
      directives      : += -DskipDefault -P platform-ee

  ################################################################################
  # Added to resolve pipeline issues with -Drelease and obfusation and lincense  #
  # issues.  per Steve Maring                                                    #
  ################################################################################
  3300:
    - jobID           : pentaho-scheduler-plugin
      scmUrl          : https://github.com/pentaho/pentaho-scheduler-plugin.git
      scmBranch       : scheduler-plugin

    - jobID           : geo-plugin
      scmUrl          : https://github.com/pentaho/pentaho-platform-plugin-geo.git
      archivable      : true

  3400:
    - jobID           : analyzer-plugin
      scmUrl          : https://github.com/pentaho/pentaho-analyzer.git
      directives      : += -Dagilebi
      archivable      : true

  3600:
    - jobID           : karaf-assembly
      scmUrl          : https://github.com/pentaho/pentaho-karaf-assembly.git
      testable        : false

    - jobID           : dashboards-plugin
      scmUrl          : https://github.com/pentaho/pentaho-platform-plugin-dashboards.git
      archivable      : true

  3700:
    - jobID           : pir-plugin
      scmUrl          : https://github.com/pentaho/pentaho-platform-plugin-interactive-reporting.git
      archivable      : true
      parallelize     : true

  3800:
    - jobID           : karaf-assembly-ee
      scmUrl          : https://github.com/pentaho/pentaho-karaf-ee-assembly.git
      testable        : false

  4400:
    - jobID           : platform-server-assembly
      scmUrl          : https://github.com/pentaho/pentaho-platform.git
      scmBranch       : scheduler-plugin
      directives      : += -DskipDefault -P platform-assemble
      testable        : false
      archivable      : true

  ################################################################################
  # NOTE placed jobId 'pentaho-scheduler-plugin-ee' to be in built at the time   #
  #  as similiar jonbs in suite-snapshot.yaml:                                   #
  #   -  'platform-chart-plugin-ee'                                              #
  #   -  'analysis-plugin-ee'                                                    #
  # It's possible to move this jobId to an earlier jobGroup, this is a           #
  # cautionary placement.                                                        #
  ################################################################################
  4450:
    - jobID           : pentaho-scheduler-plugin-ee
      scmUrl          : https://github.com/pentaho/pentaho-scheduler-plugin-ee.git
      scmBranch       : scheduler-plugin
      versionProperty : pentaho-scheduler-plugin-ee.version

  ################################################################################
  # NOTE groupId:jobId 4500:'platform-server-assembly-ee' already existed        #
  # branch has new code that packages artifacts                                  #
  # from jobId 'pentaho-scheduler-plugin-ee'                                     #
  ################################################################################
  4500:
    - jobID           :  platform-server-assembly-ee
      scmUrl          :  https://github.com/pentaho/pentaho-platform-ee.git
      scmBranch       :  scheduler-plugin
      directives      :  += -DskipDefault -P platform-ee-assemble
      testable        :  false
      archivable      :  true
      versionProperty :  pentaho-scheduler-plugin-ee.version

  ################################################################################
  # NOTE adding jobids 'installers', 'installer-tool' to generate files such as: #
  #  pentaho-business-analytics-9.6.0.0-SNAPSHOT...                              #
  ################################################################################
  4700:
    - jobID           :  installers
      scmUrl          :  https://github.com/pentaho/pentaho-installer.git
      dockerImage     :  jenkins-build/bitrock-installbuilder-8
      archivable      :  true
      testable        :  false
      parallelize     :  true
